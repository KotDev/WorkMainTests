# Тестовое задание

### Задача:
Нужно написать cli-приложение, которое будет анализировать логи django-приложения и формировать отчеты. Отчет выводится в консоль. Интерфейс приложения:
* можно передать пути к логам, файлов может быть несколько
* можно указать аргумент --report c названием отчета который нужно сформировать

### Пример
```
python3 main.py logs/app1.log logs/app2.log logs/app3.log --report handlers
```
```
Пример вывода:

Total requests: 1000

HANDLER               	DEBUG  	INFO   	WARNING	ERROR  	CRITICAL  
/admin/dashboard/     	20     		72     	19     		14     		18  	 
/api/v1/auth/login/   	23     		78     	14     		15     		18  	 
/api/v1/orders/       	26     		77     	12     		19     		22  	 
/api/v1/payments/     	26     		69     	14     		18     		15  	 
/api/v1/products/     	23     		70     	11     		18     		18  	 
/api/v1/shipping/     	60     		128    	26     		32     		25  	 
...                     178    		494    	96     		116    		116
```

### Запуск программы

Первое что необходимо сделать это добавить в дирректорию logs файл с логами. После чего выполнит
следующую команду:
```
python3 src/main.py app1.log app2.log app3.log --handler
```

Достаточно указать только имя файла лога, в случае если имя файла не совпадает с аргументом cli строки,
то сработает ошибка ValueError. Так же необходимо указать флаг, в данном случае это --handler.

Программа выдаёт отчет в нужном формате, но работает с одним флагом, если нам необходимо что бы программа обрабатывала и
логи других уровней, то необходимо лишь дполнить список ``log_levels``, и изменить регулярные выражения в методе ``counter_log()``

### Результат работы программы
Результат обработки 3-х файлов с логами
```commandline
Total requests: 188
HANDLER             DEBUG     INFO      WARNING   ERROR     CRITICAL  
/api/v1/reviews/    0         20        0         4         0         
/admin/dashboard/   0         13        0         4         0         
/api/v1/users/      0         9         0         3         0         
/api/v1/cart/       0         9         0         1         0         
/api/v1/products/   0         12        0         5         0         
/api/v1/support/    0         16        0         4         0         
/api/v1/auth/login/ 0         12        0         2         0         
/admin/login/       0         12        0         4         0         
/api/v1/checkout/   0         15        0         4         0         
/api/v1/payments/   0         12        0         2         0         
/api/v1/orders/     0         10        0         4         0         
/api/v1/shipping/   0         8         0         3         0   
```

### Алгоритм работы программы
#### Структура
Был создан класс CounterLogs для удобства последующего интегрирования в другие класса обработки логов.
Данный класс в результате использования метода ``create_report()`` сохраняет в своём атрибуте ``report`` словарь с
подсчётом лог левела каждого репорта. Все функции кроме функции ``print_report()`` являются ассинхронными, это необходимо
для обработки нескольких файлов.

#### Алгоритм
Есть список файлов, выбираем файл (первый), после чего считываем его построчно, в строке находим левел лога и 
django.request (это означает что это именно api запрос), если ключа в виде api запроса в словаре ``report`` нет то
добавяем этот api как ключ, а его значением устанавливаем словарь где ключом является лог левел, а его значение кол-во данного
лог левела конкретного api запроса. Если же api запрос повторяется, то просто достаём его в словаре и к лог левелу прибавляем 1
Так происходит до тех пор, пока файл не будет прочитан полностью. После чего выбирается следующий фалй на обработку.
``report`` будет формироваться до тех пор, пока все файлы списка ``file_path`` не будут считаны.

### Тесты
Изначально скачиваем все зависимости из файла ``req.txt`` командой
```commandline
pip3 install -r req.txt
```
Для запуска тестов необходимо использовать следующую команду
```
pytest tests/tests.py
```
### Результат тестов
```commandline
======================================================================================================= test session starts ========================================================================================================
platform linux -- Python 3.11.0rc1, pytest-8.3.5, pluggy-1.5.0
rootdir: /home/danil/PycharmProjects/TestTask
plugins: asyncio-0.26.0
asyncio: mode=Mode.STRICT, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 4 items                                                                                                                                                                                                                  

tests/tests.py ....                                                                                                                                                                                                          [100%]

========================================================================================================= warnings summary =========================================================================================================
tests/tests.py::TestCounterLog::test_initial
  tests/tests.py:13: PytestWarning: The test <Function test_initial> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=================================================================================================== 4 passed, 1 warning in 0.01s ===================================================================================================
```

### Скриншеты
Все скриншеты результаов работы можно найти по пути ``src/screenshots``